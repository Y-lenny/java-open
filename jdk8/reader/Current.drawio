<mxfile host="drawio-plugin" modified="2021-10-20T16:30:54.296Z" agent="5.0 (Macintosh; Intel Mac OS X 10_16_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36" etag="UrxJaYd4-IQMLYRBXT9k" version="14.7.4" type="embed" pages="2"><diagram id="23iRSUPoRavnBvh4doch" name="ThreadPoolExecutor-execute"><mxGraphModel dx="718" dy="605" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="135" value="" style="whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=#FF0000;dashed=1;strokeWidth=3;" parent="1" vertex="1"><mxGeometry x="2080" y="740" width="610" height="970" as="geometry"/></mxCell><mxCell id="4" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="2" target="3" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="6" value="&lt;span style=&quot;font-size: 12px&quot;&gt;提交任务&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="4" vertex="1" connectable="0"><mxGeometry x="-0.1111" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="2" value="" style="shape=waypoint;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="280" y="20" width="40" height="40" as="geometry"/></mxCell><mxCell id="8" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="3" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="300" y="270" as="targetPoint"/></mxGeometry></mxCell><mxCell id="15" value="&lt;span style=&quot;font-size: 12px&quot;&gt;判断是否小于&lt;/span&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;核心线程数&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="8" vertex="1" connectable="0"><mxGeometry x="0.05" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="3" value="execute(runnable)" style="whiteSpace=wrap;html=1;fillColor=none;sketch=1;" parent="1" vertex="1"><mxGeometry x="240" y="130" width="120" height="60" as="geometry"/></mxCell><mxCell id="5" value="开始" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;sketch=1;" parent="1" vertex="1"><mxGeometry x="280" y="10" width="40" height="20" as="geometry"/></mxCell><mxCell id="10" value="Y" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="20" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="340" y="290" as="sourcePoint"/><mxPoint x="400" y="290" as="targetPoint"/></mxGeometry></mxCell><mxCell id="13" value="N" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="11" target="12" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="16" value="判断是否队列已经满" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="13" vertex="1" connectable="0"><mxGeometry x="0.125" y="-2" relative="1" as="geometry"><mxPoint x="2" y="15" as="offset"/></mxGeometry></mxCell><mxCell id="11" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="260" y="270" width="80" height="40" as="geometry"/></mxCell><mxCell id="18" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="12" target="17" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="19" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="18" vertex="1" connectable="0"><mxGeometry x="-0.3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="28" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="12" target="27" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="33" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="28" vertex="1" connectable="0"><mxGeometry x="0.125" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="34" value="判断是否小于最大线程数" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="28" vertex="1" connectable="0"><mxGeometry x="0.425" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="12" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="260" y="390" width="80" height="40" as="geometry"/></mxCell><mxCell id="31" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="17" target="29" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="17" value="添加任务队列中" style="whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="400" y="380" width="120" height="60" as="geometry"/></mxCell><mxCell id="46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" parent="1" source="20" target="45" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="48" value="addWoker(runnable,true) 基于核心线程创建" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="46" vertex="1" connectable="0"><mxGeometry x="-0.3378" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="20" value="&lt;span&gt;封装Worker&lt;/span&gt;&lt;br&gt;&lt;span&gt;启动新线程&lt;/span&gt;" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="610" y="260" width="120" height="60" as="geometry"/></mxCell><mxCell id="24" value="&lt;div&gt;如果线程池已经处于非运行状态,则从缓冲队列&lt;/div&gt;&lt;div&gt;中移除任务然后采用线程池指定的策略拒绝任务&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;如果线程池中线程数量为0,则通过addWorker(null, false)&lt;span&gt;尝试新建一个线程,新建线程对应的任务为null&lt;/span&gt;&lt;/div&gt;" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;align=left;verticalAlign=top;size=0.16666666666666666;sketch=1;" parent="1" vertex="1"><mxGeometry x="820" y="332.5" width="160" height="155" as="geometry"/></mxCell><mxCell id="36" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="27" target="44" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="400" y="530" as="targetPoint"/></mxGeometry></mxCell><mxCell id="37" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="36" vertex="1" connectable="0"><mxGeometry x="-0.3333" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="39" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="27" target="38" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="40" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];sketch=1;" parent="39" vertex="1" connectable="0"><mxGeometry x="-0.2857" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="27" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="260" y="510" width="80" height="40" as="geometry"/></mxCell><mxCell id="32" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;sketch=1;" parent="1" source="29" target="24" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="29" value="添加成功后再判断线程状态和运行线程数" style="whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="610" y="380" width="120" height="60" as="geometry"/></mxCell><mxCell id="42" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="38" target="41" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="38" value="使用拒绝策略" style="whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="240" y="620" width="120" height="60" as="geometry"/></mxCell><mxCell id="41" value="" style="shape=waypoint;size=6;pointerEvents=1;points=[];fillColor=#2a2a2a;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;sketch=1;" parent="1" vertex="1"><mxGeometry x="280" y="770" width="40" height="40" as="geometry"/></mxCell><mxCell id="43" value="结束" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;sketch=1;" parent="1" vertex="1"><mxGeometry x="280" y="790" width="40" height="20" as="geometry"/></mxCell><mxCell id="47" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="44" target="45" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49" value="addWoker(runnable,false) 基于最大线程创建" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="47" vertex="1" connectable="0"><mxGeometry x="-0.3673" y="3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="44" value="&lt;span style=&quot;&quot;&gt;封装Worker&lt;/span&gt;&lt;br style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;启动新线程&lt;/span&gt;" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;align=center;verticalAlign=middle;sketch=1;" parent="1" vertex="1"><mxGeometry x="610" y="500" width="120" height="60" as="geometry"/></mxCell><mxCell id="51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="45" target="50" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="45" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;quot;menlo&amp;quot; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #97e76b&quot;&gt;addWorker(runnable,core)&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1"><mxGeometry x="1010" y="360" width="200" height="60" as="geometry"/></mxCell><mxCell id="53" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="50" target="52" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="50" value="判断线程状态是否&lt;br&gt;可以接收新任务" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1330" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="55" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="52" target="54" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="56" value="封装worker" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="55" vertex="1" connectable="0"><mxGeometry x="-0.375" y="-1" relative="1" as="geometry"><mxPoint x="15" y="-1" as="offset"/></mxGeometry></mxCell><mxCell id="52" value="判断线程数是否&lt;br&gt;超过最大线程数" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1560" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="78" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="54" target="77" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="82" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="54" target="81" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="54" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;b&gt;&lt;span style=&quot;color: #e84b94&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;Worker&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fdc323&quot;&gt;runnable&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;/b&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1780" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="77" value="Worker 实现Runnable接口&lt;br&gt;Worker 封装Thread和Runnable任务&lt;br&gt;Worker 作为执行任务传递给Thread通过他连接线程与任务的关联关系。" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;size=0.18181818181818182;align=left;verticalAlign=top;" parent="1" vertex="1"><mxGeometry x="1725.5" y="210" width="229" height="100" as="geometry"/></mxCell><mxCell id="84" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="81" target="83" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="81" value="添加至工作线程池中&lt;br&gt;(&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt ; color: rgb(221 , 221 , 221)&quot;&gt;workers&lt;/span&gt;&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;background-color: rgb(43 , 43 , 43) ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;font color=&quot;#dddddd&quot;&gt;add&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt ; color: rgb(255 , 255 , 255)&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt ; color: rgb(253 , 195 , 35)&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt ; color: rgb(255 , 255 , 255)&quot;&gt;)&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1980" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="88" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="83" target="87" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="83" value="开启线程(thread.start())" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="92" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="87" target="91" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="87" value="执行Worker.run()方法" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="500" width="120" height="60" as="geometry"/></mxCell><mxCell id="94" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="91" target="93" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="91" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;quot;menlo&amp;quot; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #97e76b&quot;&gt;runWorker&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #54e0e8&quot;&gt;Worker &lt;/span&gt;&lt;span style=&quot;color: #fdc323&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1"><mxGeometry x="2180" y="640" width="120" height="60" as="geometry"/></mxCell><mxCell id="97" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="93" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="2240" y="920" as="targetPoint"/></mxGeometry></mxCell><mxCell id="98" value="首个任务是否为空" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="97" vertex="1" connectable="0"><mxGeometry x="-0.125" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="93" value="&lt;span style=&quot;font-size: 11px&quot;&gt;获取当前工作线程首个任务&lt;br&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2170" y="780" width="140" height="60" as="geometry"/></mxCell><mxCell id="103" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="101" target="102" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="108" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="103" vertex="1" connectable="0"><mxGeometry x="-0.1429" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="106" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="101" target="105" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="107" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="106" vertex="1" connectable="0"><mxGeometry x="-0.2" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="101" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;" parent="1" vertex="1"><mxGeometry x="2200" y="920" width="80" height="40" as="geometry"/></mxCell><mxCell id="113" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="102" target="112" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="102" value="判断线程池状态" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1030" width="120" height="60" as="geometry"/></mxCell><mxCell id="111" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="105" target="102" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="2400" y="1060"/></Array></mxGeometry></mxCell><mxCell id="122" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="105" target="121" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="128" value="获取为空" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="122" vertex="1" connectable="0"><mxGeometry x="-0.425" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="105" value="从任务队列中获取&lt;br&gt;(getTask())" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2340" y="910" width="120" height="60" as="geometry"/></mxCell><mxCell id="115" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="112" target="114" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="116" value="执行工作任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="115" vertex="1" connectable="0"><mxGeometry x="-0.025" y="2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="112" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;执行线程前置处理&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;beforeExecute&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1170" width="120" height="60" as="geometry"/></mxCell><mxCell id="118" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="114" target="117" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="114" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;task&lt;/span&gt;.&lt;span style=&quot;color: #dddddd&quot;&gt;run&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1310" width="120" height="60" as="geometry"/></mxCell><mxCell id="119" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="117" target="101" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="2130" y="1480"/><mxPoint x="2130" y="940"/></Array></mxGeometry></mxCell><mxCell id="120" value="循环队列剩余任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="119" vertex="1" connectable="0"><mxGeometry x="-0.197" y="2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="125" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="117" target="124" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="117" value="执行线程后置处理&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;afterExecute&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;task&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;thrown&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;; &lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1450" width="120" height="60" as="geometry"/></mxCell><mxCell id="126" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="121" target="124" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="127" value="没有可以执行的任务（可能因为以上原因导致返回为空）" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="126" vertex="1" connectable="0"><mxGeometry x="-0.3558" y="-20" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="121" value="线程池stop&lt;br&gt;队列为空&lt;br&gt;超时" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2540" y="910" width="120" height="60" as="geometry"/></mxCell><mxCell id="130" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="124" target="129" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="124" value="执行工作线程退出" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1590" width="120" height="60" as="geometry"/></mxCell><mxCell id="132" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="129" target="131" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="129" value="从工作线程池移除&lt;br&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;menlo&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;workers&lt;/span&gt;.&lt;span style=&quot;color: #dddddd&quot;&gt;remove&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fdc323&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1730" width="120" height="60" as="geometry"/></mxCell><mxCell id="134" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="131" target="133" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="131" value="始终维持最小线程数" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="2180" y="1870" width="120" height="60" as="geometry"/></mxCell><mxCell id="133" value="" style="shape=waypoint;size=6;pointerEvents=1;points=[];fillColor=#2a2a2a;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;" parent="1" vertex="1"><mxGeometry x="2220" y="2020" width="40" height="40" as="geometry"/></mxCell><mxCell id="136" value="&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;线程复用逻辑&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="1" vertex="1"><mxGeometry x="2325" y="710" width="90" height="20" as="geometry"/></mxCell><mxCell id="137" value="" style="whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=#FF0000;dashed=1;strokeWidth=3;" parent="1" vertex="1"><mxGeometry x="160" y="80" width="630" height="650" as="geometry"/></mxCell><mxCell id="138" value="&lt;b&gt;线程池任务添加主流程&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="1" vertex="1"><mxGeometry x="390" y="50" width="140" height="20" as="geometry"/></mxCell><mxCell id="141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="139" target="140" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="139" value="主线程" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="730" y="960" width="120" height="60" as="geometry"/></mxCell><mxCell id="146" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="140" target="142" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="990" y="1180"/></Array></mxGeometry></mxCell><mxCell id="147" value="1. addWorker(添加工作线程)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="146" vertex="1" connectable="0"><mxGeometry x="0.02" y="37" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="149" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="140" target="148" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="990" y="775"/></Array></mxGeometry></mxCell><mxCell id="150" value="2.&amp;nbsp;&lt;span style=&quot;font-size: 14px;&quot;&gt;workQueue.offer&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="149" vertex="1" connectable="0"><mxGeometry x="-0.4447" y="-9" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="140" value="execute" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="930" y="960" width="120" height="60" as="geometry"/></mxCell><mxCell id="154" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;entryX=0.627;entryY=1.052;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="142" target="148" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="155" value="3. workQueue.poll/take()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" parent="154" vertex="1" connectable="0"><mxGeometry x="-0.0161" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="142" value="core poll" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1"><mxGeometry x="1410" y="960" width="160" height="440" as="geometry"/></mxCell><mxCell id="143" value="Worker(task,runnable)" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1430" y="1010" width="120" height="60" as="geometry"/></mxCell><mxCell id="144" value="Worker(task,runnable)" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1430" y="1110" width="120" height="60" as="geometry"/></mxCell><mxCell id="145" value="Worker(task,runnable)" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1430" y="1220" width="120" height="60" as="geometry"/></mxCell><mxCell id="148" value="blockQueue" style="whiteSpace=wrap;html=1;align=right;" parent="1" vertex="1"><mxGeometry x="1140" y="720" width="560" height="110" as="geometry"/></mxCell><mxCell id="151" value="task-1" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#f0f0f0;" parent="1" vertex="1"><mxGeometry x="1170" y="735" width="120" height="80" as="geometry"/></mxCell><mxCell id="152" value="task-2" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#f0f0f0;" parent="1" vertex="1"><mxGeometry x="1310" y="735" width="120" height="80" as="geometry"/></mxCell><mxCell id="153" value="task-3" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#f0f0f0;" parent="1" vertex="1"><mxGeometry x="1450" y="735" width="120" height="80" as="geometry"/></mxCell><mxCell id="157" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#f0f0f0;" parent="1" source="156" target="139" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="156" value="" style="shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;fontColor=#f0f0f0;align=right;verticalAlign=top;" parent="1" vertex="1"><mxGeometry x="620" y="970" width="40" height="40" as="geometry"/></mxCell><mxCell id="158" value="&lt;span&gt;开始&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontColor=#f0f0f0;" parent="1" vertex="1"><mxGeometry x="590" y="980" width="40" height="20" as="geometry"/></mxCell></root></mxGraphModel></diagram><diagram id="mcGFQGTBbwnMyMKNfAcp" name="AQS(Exclude+Condition)"><mxGraphModel dx="1695" dy="712" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="CqpKU-a3tO_jiACDVcot-0"/><mxCell id="CqpKU-a3tO_jiACDVcot-1" parent="CqpKU-a3tO_jiACDVcot-0"/><mxCell id="j-NlaD5QjTGuLUv5OBM--4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--0" target="j-NlaD5QjTGuLUv5OBM--3"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--0" value="" style="shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="220" y="110" width="40" height="40" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--2" value="获取锁(&lt;span style=&quot;color: rgb(255 , 0 , 0) ; font-size: 11px&quot;&gt;lock&lt;/span&gt;)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="200" y="90" width="80" height="20" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--3" target="j-NlaD5QjTGuLUv5OBM--5"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--3" value="&lt;pre style=&quot;font-family: &amp;quot;fira code medium&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;fira code medium&amp;quot; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;&quot;&gt;acquire&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;int &lt;/span&gt;arg&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;labelBackgroundColor=none;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="180" y="220" width="120" height="60" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--5"><mxGeometry relative="1" as="geometry"><mxPoint x="100" y="390" as="targetPoint"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--5" target="j-NlaD5QjTGuLUv5OBM--18"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--30" value="获取锁失败进入虚拟队列" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="j-NlaD5QjTGuLUv5OBM--19"><mxGeometry x="-0.025" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--5" value="&lt;pre style=&quot;font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #97e76b&quot;&gt;tryAcquire&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e84b94&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: #fdc323&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(43 , 43 , 43) ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;font color=&quot;#ffffff&quot;&gt;获取锁&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;labelBackgroundColor=none;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="182" y="360" width="116" height="60" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--11" value="判断锁状态" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--9" target="j-NlaD5QjTGuLUv5OBM--10"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--9" value="tryAcquire(acquires)&lt;br&gt;模板方法实现逻辑" style="whiteSpace=wrap;html=1;labelBackgroundColor=none;fontColor=#f0f0f0;align=center;verticalAlign=middle;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="-20" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--10" target="j-NlaD5QjTGuLUv5OBM--12"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--17" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="j-NlaD5QjTGuLUv5OBM--13"><mxGeometry y="3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--10" target="j-NlaD5QjTGuLUv5OBM--14"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--16" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="j-NlaD5QjTGuLUv5OBM--15"><mxGeometry x="0.0286" y="3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--10" value="status=0" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="-200" y="370" width="80" height="40" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--12" value="1.判断当前线程占用?&lt;br&gt;2.更新锁的占用次数&lt;br&gt;(所以是重入锁)" style="whiteSpace=wrap;html=1;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="-220" y="480" width="120" height="60" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--14" value="1.判断是否队列第一?&lt;br&gt;2.&lt;span style=&quot;color: rgb(165 , 165 , 165) ; background-color: rgb(43 , 43 , 43) ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;volatile+CAS?&lt;br&gt;&lt;/span&gt;&lt;span&gt;3.设置占用锁(2成功)&amp;nbsp;&lt;/span&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="-220" y="240" width="120" height="60" as="geometry"/></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--18" target="j-NlaD5QjTGuLUv5OBM--20"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-0" value="创建node+竞争tail" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="j-NlaD5QjTGuLUv5OBM--21"><mxGeometry x="-0.225" y="4" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--18" value="&lt;pre style=&quot;background-color: rgb(43, 43, 43); font-family: &amp;quot;fira code medium&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;span style=&quot;&quot;&gt;addWaiter&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;Node&lt;/span&gt;.&lt;span style=&quot;font-style: italic;&quot;&gt;EXCLUSIVE&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="180" y="500" width="120" height="60" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="j-NlaD5QjTGuLUv5OBM--20" target="QfQNJ6-P8okqvq2IUeYL-1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-3" value="自旋入队" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="QfQNJ6-P8okqvq2IUeYL-2"><mxGeometry x="0.025" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="j-NlaD5QjTGuLUv5OBM--20" value="1.创建Node节点&lt;br&gt;2.CAS&lt;span&gt;竞争&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 229 , 30) ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 13.0667px ; background-color: rgb(43 , 43 , 43)&quot;&gt;tail变量&lt;/span&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;labelBackgroundColor=none;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="180" y="640" width="120" height="60" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" target="QfQNJ6-P8okqvq2IUeYL-4"><mxGeometry relative="1" as="geometry"><mxPoint x="238" y="980" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-6" value="重新获取失败&lt;br&gt;阻塞当前线程，同时唤醒将从此继续执行" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="QfQNJ6-P8okqvq2IUeYL-5"><mxGeometry x="-0.075" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-13" value="判断当前节点的pre节点是否是head节点 ？" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontColor=#FF0000;strokeColor=#FF0000;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="QfQNJ6-P8okqvq2IUeYL-1" target="QfQNJ6-P8okqvq2IUeYL-12"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-1" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;acquireQueued&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="180" y="780" width="120" height="60" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#f0f0f0;elbow=vertical;curved=1;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="QfQNJ6-P8okqvq2IUeYL-4" target="QfQNJ6-P8okqvq2IUeYL-7"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-9" value="检查唤醒后的线程状态是否正常" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#f0f0f0;" vertex="1" connectable="0" parent="QfQNJ6-P8okqvq2IUeYL-8"><mxGeometry x="0.025" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-4" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #54e0e8&quot;&gt;LockSupport&lt;/span&gt;.&lt;span style=&quot;color: #dddddd ; font-style: italic&quot;&gt;park&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e84b94&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="178" y="1060" width="120" height="60" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontColor=#FF0000;strokeColor=#FF0000;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="QfQNJ6-P8okqvq2IUeYL-7" target="QfQNJ6-P8okqvq2IUeYL-1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="360" y="1230"/><mxPoint x="360" y="810"/></Array></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-16" value="for(;;)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF0000;" vertex="1" connectable="0" parent="QfQNJ6-P8okqvq2IUeYL-15"><mxGeometry x="0.1218" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-7" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;fira code medium&amp;#34; , monospace ; font-size: 9.8pt&quot;&gt;&lt;span style=&quot;color: #54e0e8&quot;&gt;Thread&lt;/span&gt;.&lt;span style=&quot;color: #dddddd ; font-style: italic&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;color: #ffffff&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #dddddd&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="178" y="1200" width="120" height="60" as="geometry"/></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-11" value="&lt;b&gt;此处唤醒&lt;/b&gt;" style="shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.4;arrowSize=0.4;dashed=1;labelBackgroundColor=none;strokeColor=#FF0000;align=center;verticalAlign=middle;fontColor=#FF0000;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="58" y="1060" width="80" height="60" as="geometry"/></mxCell><mxCell id="eKz_uQq7wiBmLRdJBDyf-1" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontColor=#FF0000;strokeColor=#FF0000;" edge="1" parent="CqpKU-a3tO_jiACDVcot-1" source="QfQNJ6-P8okqvq2IUeYL-12" target="eKz_uQq7wiBmLRdJBDyf-0"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="eKz_uQq7wiBmLRdJBDyf-2" value="重新获取成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF0000;" vertex="1" connectable="0" parent="eKz_uQq7wiBmLRdJBDyf-1"><mxGeometry x="-0.425" y="2" relative="1" as="geometry"><mxPoint x="-7" y="-2" as="offset"/></mxGeometry></mxCell><mxCell id="QfQNJ6-P8okqvq2IUeYL-12" value="是,就进行锁重新获取" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="180" y="920" width="120" height="60" as="geometry"/></mxCell><mxCell id="eKz_uQq7wiBmLRdJBDyf-0" value="从虚拟队列中移除" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="CqpKU-a3tO_jiACDVcot-1"><mxGeometry x="-20" y="920" width="120" height="60" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>