<mxfile host="app.diagrams.net" modified="2021-10-18T08:55:04.920Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36" etag="gijmDHIrlkcgwaUWgK8K" version="15.5.4" type="github" pages="2">
  <diagram id="23iRSUPoRavnBvh4doch" name="内存模型-1.8">
    <mxGraphModel dx="1773" dy="1782" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2" value="虚拟机(JVM)" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="150" y="110" width="510" height="470" as="geometry" />
        </mxCell>
        <mxCell id="3" value="&lt;span&gt;堆(Heap&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;-Xms,-Xmx 共享区" style="whiteSpace=wrap;html=1;verticalAlign=top;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="140" width="470" height="270" as="geometry" />
        </mxCell>
        <mxCell id="10" value="字符串常量池" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="192.5" y="370" width="425" height="30" as="geometry" />
        </mxCell>
        <mxCell id="36" value="" style="group;sketch=1;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="150" y="597" width="510" height="110" as="geometry" />
        </mxCell>
        <mxCell id="16" value="本地内存" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;shadow=1;sketch=1;" parent="36" vertex="1">
          <mxGeometry width="510" height="110" as="geometry" />
        </mxCell>
        <mxCell id="18" value="元空间(Mate Space),非堆&lt;br&gt;&lt;span class=&quot;token class-name&quot; style=&quot;box-sizing: border-box ; min-height: 1.5rem ; position: relative ; left: auto ; font-family: &amp;#34;roboto mono&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; font-size: 12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;labelBackgroundColor=none;shadow=1;sketch=1;" parent="36" vertex="1">
          <mxGeometry x="20" y="30" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="20" value="直接内存(Direct Memory)" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;shadow=1;sketch=1;" parent="36" vertex="1">
          <mxGeometry x="264" y="30" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="50" value="运行时常量池" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="36" vertex="1">
          <mxGeometry x="30" y="63" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="51" value="类对象" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="36" vertex="1">
          <mxGeometry x="140" y="63" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="37" value="" style="group;sketch=1;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="170" y="420" width="210" height="150" as="geometry" />
        </mxCell>
        <mxCell id="31" value="&lt;span&gt;线程(Thread) -Xss,私有区&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="37" vertex="1">
          <mxGeometry width="210" height="150" as="geometry" />
        </mxCell>
        <mxCell id="32" value="&lt;span&gt;虚拟机栈&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="37" vertex="1">
          <mxGeometry x="20" y="26" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="33" value="&lt;span&gt;本地方法栈&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="37" vertex="1">
          <mxGeometry x="20" y="66" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="34" value="程序计数器" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="37" vertex="1">
          <mxGeometry x="20" y="106" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="38" value="" style="group;sketch=1;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="430" y="420" width="210" height="150" as="geometry" />
        </mxCell>
        <mxCell id="23" value="线程(Thread) -Xss,私有区" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="38" vertex="1">
          <mxGeometry width="210" height="150" as="geometry" />
        </mxCell>
        <mxCell id="24" value="&lt;span&gt;虚拟机栈&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="38" vertex="1">
          <mxGeometry x="20" y="26" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="25" value="&lt;span&gt;本地方法栈&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="38" vertex="1">
          <mxGeometry x="20" y="66" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="26" value="程序计数器" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="38" vertex="1">
          <mxGeometry x="20" y="106" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="39" value="" style="group;sketch=1;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="195" y="170" width="420" height="180" as="geometry" />
        </mxCell>
        <mxCell id="7" value="" style="whiteSpace=wrap;html=1;sketch=1;" parent="39" vertex="1">
          <mxGeometry width="420" height="180" as="geometry" />
        </mxCell>
        <mxCell id="11" value="年轻代(Yon Gen)&lt;span style=&quot;font-size: 14px; text-align: left;&quot;&gt;-Xmn,&lt;/span&gt;&lt;span style=&quot;font-size: 13px;&quot;&gt;-XX:NewRatio&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;labelBackgroundColor=none;sketch=1;" parent="39" vertex="1">
          <mxGeometry x="25" y="30" width="260" height="120" as="geometry" />
        </mxCell>
        <mxCell id="12" value="Old Gen" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="39" vertex="1">
          <mxGeometry x="305" y="30" width="90" height="120" as="geometry" />
        </mxCell>
        <mxCell id="13" value="新生儿(Eden)&lt;br&gt;&lt;span style=&quot;font-size: 14px; text-align: left;&quot;&gt;-XX:SurvivorRatio&lt;/span&gt;" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;labelBackgroundColor=none;sketch=1;" parent="39" vertex="1">
          <mxGeometry x="45" y="60" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="14" value="S1" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="39" vertex="1">
          <mxGeometry x="189" y="60" width="30" height="70" as="geometry" />
        </mxCell>
        <mxCell id="15" value="S2" style="whiteSpace=wrap;html=1;align=center;verticalAlign=top;sketch=1;" parent="39" vertex="1">
          <mxGeometry x="235" y="60" width="30" height="70" as="geometry" />
        </mxCell>
        <mxCell id="40" value="&lt;h2 id=&quot;JVM参数调优必知-调优GC&quot; style=&quot;margin: 30px 0px 0px ; padding: 0px ; font-weight: normal ; font-size: 20px ; line-height: 1.5 ; letter-spacing: -0.008em ; border-bottom-color: rgb(255 , 255 , 255)&quot;&gt;调优GC&lt;/h2&gt;&lt;h3 id=&quot;JVM参数调优必知-1.参数选项&quot; style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 16px ; line-height: 1.5 ; letter-spacing: -0.006em&quot;&gt;1.&amp;nbsp;参数选项&lt;/h3&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;先说VM选项， 三种：&lt;/p&gt;&lt;ul style=&quot;margin: 10px 0px 0px ; font-size: 14px&quot;&gt;&lt;li&gt;- : 标准VM选项，VM规范的选项&lt;/li&gt;&lt;li&gt;-X: 非标准VM选项，不保证所有VM支持&lt;/li&gt;&lt;li&gt;-XX: 高级选项，高级特性，但属于不稳定的选项&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;参见&amp;nbsp;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html%23Options&quot; class=&quot;external-link&quot; target=&quot;_blank&quot;&gt;Java HotSpot VM Options&lt;/a&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;常见的一些JVM参数，其语义分别是：&lt;/p&gt;&lt;ul style=&quot;margin: 10px 0px 0px ; font-size: 14px&quot;&gt;&lt;li&gt;&lt;strong&gt;-Xmx: 堆的最大内存数，等同于-XX:MaxHeapSize&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;-Xms: 堆的初始化初始化大小&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;-Xmn: 堆中新生代初始及最大大小，如果需要进一步细化，初始化大小用-XX:NewSize，最大大小用-XX:MaxNewSize&lt;/li&gt;&lt;li&gt;-Xss: 线程栈大小，等同于-XX:ThreadStackSize&lt;/li&gt;&lt;li&gt;-XX:PermSize&amp;nbsp;JVM初始分配的非堆内存&lt;strong&gt;&amp;nbsp;&lt;/strong&gt;&amp;nbsp;-XX:MaxPermSize&amp;nbsp;JVM最大允许分配的非堆内存，按需分配&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;命名应该非简称，助记的话： memory maximum, memory startup, memory nursery/new, stack size.&lt;/p&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;&lt;span style=&quot;font-size: 16px ; letter-spacing: -0.006em&quot;&gt;2.调优标准&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;分析GC结果，确定是否需要调优，可参考以下标准（实际标准以应用的实际情况为准）&lt;/p&gt;&lt;ul style=&quot;margin: 10px 0px 0px ; font-size: 14px&quot;&gt;&lt;li&gt;Minor GC平均耗时少于50毫秒&lt;/li&gt;&lt;li&gt;Minor GC平均频率少于10秒&lt;/li&gt;&lt;li&gt;Full GC平均耗时少于1秒&lt;/li&gt;&lt;li&gt;Full GC平均频率少于10分钟&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;当出现OutOfMemoryError时，要确定是什么问题，是内存分配不足还是因为内存泄漏或者没有及时，可以通过jmap命令或者在命令行加入-XX:+HeapDumpOnOutOfMemoryError，然后对dump出的Heap进行分析（可以使用MAT或者jvisualvm工具）&lt;/p&gt;&lt;p style=&quot;margin: 10px 0px 0px ; padding: 0px ; font-size: 14px&quot;&gt;&lt;span style=&quot;font-size: 16px ; letter-spacing: -0.006em&quot;&gt;3.基本策略&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;ol style=&quot;margin: 10px 0px 0px ; font-size: 14px&quot;&gt;&lt;li&gt;&lt;p style=&quot;margin: 0px ; padding: 0px&quot;&gt;调整Heap中各区的大小，目标是寻找一个平衡点，在不发生OutOfMemoryError的情况下，满足应用响应时间和吞吐量的需求&lt;br&gt;增大内存，可以减少GC执行频率，但会增加GC执行时间&lt;br&gt;减少内存，可以减少GC执行时间，但会增加GC执行频率&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;margin: 0px ; padding: 0px&quot;&gt;内存不作动态调整，因为每次调整内存（Heap或Perm）都会触发FullGC&lt;br&gt;-Xms和-Xmx设置成相同（整个Heap大小不变）&lt;br&gt;设置-Xmn（Young区大小不变，从而Old区的大小也不变）&lt;br&gt;设置-XX:SurvivorRatio（Eden、两个Survivor大小不变）&lt;br&gt;-XX:PermSize和-XX:MaxPermSize设置成相同（Perm区大小不变）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p style=&quot;margin: 0px ; padding: 0px&quot;&gt;避免主动触发GC&lt;br&gt;程序调用了System.gc方法，会触发FullGC&lt;br&gt;在命令行中加入-XX:+DisableExplicitGC，可以忽略主动GC的调用&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;rounded=0;sketch=1;size=0.06666666666666667;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="-550" y="-70" width="630" height="870" as="geometry" />
        </mxCell>
        <mxCell id="41" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="42" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="460" as="sourcePoint" />
            <mxPoint x="760" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="52" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="700" y="525" width="430" height="60" as="geometry" />
        </mxCell>
        <mxCell id="42" value="栈桢(Frame)" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;align=center;verticalAlign=top;" parent="52" vertex="1">
          <mxGeometry width="430" height="60" as="geometry" />
        </mxCell>
        <mxCell id="43" value="返回值" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="52" vertex="1">
          <mxGeometry x="10" y="29" width="90" height="23" as="geometry" />
        </mxCell>
        <mxCell id="44" value="局部便量表" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="52" vertex="1">
          <mxGeometry x="115" y="29" width="90" height="23" as="geometry" />
        </mxCell>
        <mxCell id="46" value="操作数栈" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="52" vertex="1">
          <mxGeometry x="220" y="29" width="90" height="23" as="geometry" />
        </mxCell>
        <mxCell id="47" value="Class/Method指针" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;align=center;verticalAlign=top;" parent="52" vertex="1">
          <mxGeometry x="320" y="29" width="100" height="21" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="poDna8xlX-t_4Yjy4iKA" name="GC回收器">
    <mxGraphModel dx="1186" dy="613" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="CT6wC4GMqeztgkCiiaF1-0" />
        <mxCell id="CT6wC4GMqeztgkCiiaF1-1" parent="CT6wC4GMqeztgkCiiaF1-0" />
        <mxCell id="CT6wC4GMqeztgkCiiaF1-3" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;image=https://img-blog.csdn.net/20161023141932453;" parent="CT6wC4GMqeztgkCiiaF1-1" vertex="1">
          <mxGeometry x="60" y="100.77" width="1231.17" height="729.23" as="geometry" />
        </mxCell>
        <mxCell id="k0DW-4zcrN2r0TDgEfx4-1" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;image=https://img-blog.csdnimg.cn/20200630210248120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhbmdiYWdnaW8=,size_16,color_FFFFFF,t_70;" parent="CT6wC4GMqeztgkCiiaF1-1" vertex="1">
          <mxGeometry x="1370" y="100.77" width="520" height="380" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
